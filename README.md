# Классическая задача про продукты A-M в корзине и 10 правил к ним
## Описание
Описание классической задачи:

Есть продукты A, B, C, D, E, F, G, H, I, J, K, L, M. Каждый продукт стоит определенную сумму.

Есть набор правил расчета итоговой суммы:

1. Если одновременно выбраны А и B, то их суммарная стоимость уменьшается на 10% (для каждой пары А и B)
2. Если одновременно выбраны D и E, то их суммарная стоимость уменьшается на 6% (для каждой пары D и E)
3. Если одновременно выбраны E, F, G, то их суммарная стоимость уменьшается на 3% (для каждой тройки E, F, G)
4. Если одновременно выбраны А и один из [K, L, M], то стоимость выбранного продукта уменьшается на 5%
5. Если пользователь выбрал одновременно 3 продукта, он получает скидку 5% от суммы заказа
6. Если пользователь выбрал одновременно 4 продукта, он получает скидку 10% от суммы заказа
7. Если пользователь выбрал одновременно 5 продуктов, он получает скидку 20% от суммы заказа
8. Описанные скидки 5,6,7 не суммируются, применяется только одна из них
9. Продукты A и C не участвуют в скидках 5,6,7
10. Каждый товар может участвовать только в одной скидке. Скидки применяются последовательно в порядке описанном выше.

Обязательные требования:

Необходимо написать программу на PHP, которая, имея на входе набор продуктов (один продукт может встречаться несколько раз) рассчитывала суммарную их стоимость.

Программу необходимо написать максимально просто и максимально гибко. Учесть, что список продуктов практически не будет меняться, также как и типы скидок. В то время как правила скидок (какие типы скидок к каким продуктам) будут меняться регулярно.

## Проблемы
Задача поставлена с недостаточным для единственно верного решения описанием.

Например:
1. Исходя из десятого правила, пятое правило поглощает шестое, и если в корзине всего 4 товара (к которым не пришла скидка из 1-4), то сначала применится правило №5, эти товары будут помечены как использованные для создания скидки, и правило №6 обнаружит только один товар в корзине. Это означает, что для хотя бы одного использования правила №6 в корзины должны быть 7 позиций: 3 для №5 + 4 для №6. Правильно ли я понял математику или правила №7, №6, №5 должны быть расположены в обратном порядке?
2. Непонятно как правила №5-№7 соотносятся с правилами №1-№4. Допустим, у меня в корзине лежат B (100 р), D (200 р), E (300 р). Я получаю на D+E скидку в 30 рублей ((200+300)*0.06). Считаются ли эти товары использованными для подсчёта кол-ва товаров №5-№7? Другими словами, остаётся ли у меня в корзине 3 товара по мнению №5-№7? Или эти товары больше не учитываются №5-№7 ни в плане количества позиций ни в плане суммы корзины?
3. Правильно ли я понимаю, что в контексте одной корзины не может быть двух одинаковых позиций с разной ценой (что более чем возможно в реальной жизни)? В обратном случае (один товар A 100 рублей, второй товар A 30 рублей) у меня нет правила подсчёта скидки, когда её можно посчитать разными способами. В этом случае это может быть решено тремя разными способами: в порядке следования товаров, наибольшая скидка, наименьшая скидка. Например, в корзине лежат A(70)+A(100)+A(30)+B(50). (70+50)*0.1 = 12 рублей, (100+50)*0.1 = 15 рублей, (30+50)*0.1 = 8 рублей. Каждый из этих вариантов правильный.
4. Правило №4 "стоимость выбранного продукта уменьшается на 5%". Что такое "выбранный продукт"? Покупатель произвольно пальцем тыкнул в любой продукт, и у него цена уменьшилась?

Поэтому задача была дополнена:
1. Правила №5-№7 развёрнуты в обратном порядке.
2. Товары, использованные в №1-№4 никаким образом не учавствуют в №5-№7
3. При одинаковых товарах с разной ценой в одной корзине выбираются товары с самой большой ценой, таким образом покупатель получает самую большую скидку **в контексте этого правила**.
4. Правило №4: Задача не даёт нам определение "выбранного продукта", поэтому я просто выбираю N самых дорогих из тех, что прошли фильтр 

## Как собирать
```bash
composer install --no-interaction
composer tests
```

## Как тестировать
```bash
php bin/test.php -i "A=100,B=50"
php bin/test.php -i "A=100,A=50"
php bin/test.php -i "A=100,A=90,B=50"
php bin/test.php -i "A=100,B=50,C=20"
```
